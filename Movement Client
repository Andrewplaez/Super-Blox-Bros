local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local camera = workspace.CurrentCamera
local cameraPart = workspace.Map:WaitForChild("CameraPart")

local Cas = game:GetService("ContextActionService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

camera.CameraType = Enum.CameraType.Scriptable

local forwardmove = Enum.PlayerActions.CharacterForward
local backwardmove = Enum.PlayerActions.CharacterBackward 

-- Block movement
local function Sink(actionName, inputState, inputObject)
	return Enum.ContextActionResult.Sink
end

Cas:BindAction("SinkForwardMovement", Sink, false, forwardmove)
Cas:BindAction("SinkBackwardMovement", Sink, false, backwardmove)

-- Double jump variables
local hasDoubleJumped = false

-- Reset double jump when landing
humanoid.StateChanged:Connect(function(oldState, newState)
	if newState == Enum.HumanoidStateType.Landed then
		hasDoubleJumped = false
	end
end)

-- Handle jump input
UserInputService.JumpRequest:Connect(function()
	-- Allow double jump if the player is in the air (any state except running or landed)
	if humanoid.FloorMaterial == Enum.Material.Air then else task.wait(.5)
		if not hasDoubleJumped then
			hasDoubleJumped = true
			humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
		end
	end
end)

-- Camera update
RunService.RenderStepped:Connect(function()
	camera.CFrame = cameraPart.CFrame
end)

end)
